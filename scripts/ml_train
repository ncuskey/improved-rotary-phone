#!/bin/bash
#
# ML Training Wrapper Script
#
# This script ensures Python 3.11 is used for all ML training tasks
# to avoid XGBoost/OpenMP compatibility issues.
#
# Usage:
#   ./scripts/ml_train <training_script.py> [args...]
#
# Examples:
#   ./scripts/ml_train scripts/train_price_model.py
#   ./scripts/ml_train scripts/train_edition_premium_model.py
#   ./scripts/ml_train scripts/stacking/train_ebay_model.py

set -e

# Change to project root
cd "$(dirname "$0")/.."

# Use venv Python 3.11
PYTHON="${PWD}/.venv/bin/python3"

# Verify Python version
VERSION=$($PYTHON --version 2>&1 | grep -oE '[0-9]+\.[0-9]+')
if [ "$VERSION" != "3.11" ]; then
    echo "╔══════════════════════════════════════════════════════════════════════════════╗"
    echo "║                        PYTHON VERSION ERROR                                  ║"
    echo "╚══════════════════════════════════════════════════════════════════════════════╝"
    echo ""
    echo "This wrapper requires Python 3.11 in the virtual environment."
    echo "Current version: $VERSION"
    echo ""
    echo "SOLUTION:"
    echo "  1. Recreate the virtual environment with Python 3.11:"
    echo "     rm -rf .venv"
    echo "     /Users/nickcuskey/.pyenv/versions/3.11.13/bin/python3 -m venv .venv"
    echo "     .venv/bin/pip install -r requirements.txt"
    echo ""
    exit 1
fi

# Set PYTHONPATH
export PYTHONPATH="${PWD}"

# Run the training script
exec $PYTHON "$@"
